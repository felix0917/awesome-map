import cesium,echarts,echartsExt;
<div id="cesiumContainer"></div>
<script>
  let viewer = new Cesium.Viewer("cesiumContainer", {
    animation: false,
    timeline: false,
    navigationHelpButton: false,
  });

  // éšè—ç‰ˆæƒ
  viewer._cesiumWidget._creditContainer.style.display = "none";

  // æ·»åŠ è…¾è®¯åœ¨çº¿åœ°å›¾æœåŠ¡
  let tencentMapProvider = new Cesium.UrlTemplateImageryProvider({
    url:
      "https://rt{s}.map.gtimg.com/tile?z={z}&x={x}&y={reverseY}&styleid=4&scene=0&version=347",
    subdomains: ["1", "2", "3"],
  });
  viewer.scene.imageryLayers.addImageryProvider(tencentMapProvider);

  let chartContainer = document.createElement("div");
  chartContainer.className = "chartContainer";
  let cesiumContainer = document.getElementById("cesiumContainer");
  cesiumContainer.appendChild(chartContainer);

  let chartDom = document.createElement("div");
  chartDom.className = "cesium-chart";
  chartDom.style.width = viewer.canvas.width + "px";
  chartDom.style.height = viewer.canvas.height + "px";
  chartDom.setAttribute(
    "style",
    "position: absolute; top: 0px; left: 0px; pointer-events: none; width: 100%; height:100%; -webkit-tap-highlight-color: transparent; user-select: none;"
  );
  chartContainer.appendChild(chartDom);

  echarts.viewer = viewer;
  viewer.scene.canvas.setAttribute("tabIndex", 0);
  let chart = echarts.init(chartDom);
  chart.setOption(getOption());

  viewer.camera.setView({
    destination: Cesium.Cartesian3.fromDegrees(
      109.198353,
      35.758452,
      10733735.96
    ),
    orientation: {
      heading: Cesium.Math.toRadians(0),
      pitch: Cesium.Math.toRadians(-90),
    },
  });

  function getOption(e) {
    let chinaGeoCoordMap = {
      é»‘é¾™æ±Ÿ: [127.9688, 45.368],
      å†…è’™å¤: [110.3467, 41.4899],
      å‰æ—: [125.8154, 44.2584],
      åŒ—äº¬å¸‚: [116.4551, 40.2539],
      è¾½å®: [123.1238, 42.1216],
      æ²³åŒ—: [114.4995, 38.1006],
      å¤©æ´¥: [117.4219, 39.4189],
      å±±è¥¿: [112.3352, 37.9413],
      é™•è¥¿: [109.1162, 34.2004],
      ç”˜è‚ƒ: [103.5901, 36.3043],
      å®å¤: [106.3586, 38.1775],
      é’æµ·: [101.4038, 36.8207],
      æ–°ç–†: [87.9236, 43.5883],
      è¥¿è—: [91.11, 29.97],
      å››å·: [103.9526, 30.7617],
      é‡åº†: [108.384366, 30.439702],
      å±±ä¸œ: [117.1582, 36.8701],
      æ²³å—: [113.4668, 34.6234],
      æ±Ÿè‹: [118.8062, 31.9208],
      å®‰å¾½: [117.29, 32.0581],
      æ¹–åŒ—: [114.3896, 30.6628],
      æµ™æ±Ÿ: [119.5313, 29.8773],
      ç¦å»º: [119.4543, 25.9222],
      æ±Ÿè¥¿: [116.0046, 28.6633],
      æ¹–å—: [113.0823, 28.2568],
      è´µå·: [106.6992, 26.7682],
      äº‘å—: [102.9199, 25.4663],
      å¹¿ä¸œ: [113.12244, 23.009505],
      å¹¿è¥¿: [108.479, 23.1152],
      æµ·å—: [110.3893, 19.8516],
      ä¸Šæµ·: [121.4648, 31.2891],
    };

    let chinaDatas = [
      [
        {
          name: "é»‘é¾™æ±Ÿ",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "å†…è’™å¤",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "å‰æ—",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "è¾½å®",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "æ²³åŒ—",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "å¤©æ´¥",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "å±±è¥¿",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "é™•è¥¿",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "ç”˜è‚ƒ",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "å®å¤",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "é’æµ·",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "æ–°ç–†",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "è¥¿è—",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "å››å·",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "é‡åº†",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "å±±ä¸œ",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "æ²³å—",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "æ±Ÿè‹",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "å®‰å¾½",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "æ¹–åŒ—",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "æµ™æ±Ÿ",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "ç¦å»º",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "æ±Ÿè¥¿",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "æ¹–å—",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "è´µå·",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "å¹¿è¥¿",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
      [
        {
          name: "æµ·å—",
          value: 0,
          price: 100,
          num: 2,
        },
      ],
    ];

    let convertData = function(data) {
      let res = [];
      for (let i = 0; i < data.length; i++) {
        let dataItem = data[i];
        // 			console.log('dataItem',dataItem) //ç¬¬äºŒä¸ªæ•°æ®
        let fromCoord = [116.4551, 40.2539];
        let toCoord = chinaGeoCoordMap[dataItem[0].name];
        // 			console.log('toCoord',toCoord);//ç¬¬ä¸€ä¸ªåœ°å€
        if (fromCoord && toCoord) {
          res.push([
            {
              coord: fromCoord,
              value: dataItem[0].value,
            },
            {
              coord: toCoord,
              dataItem: dataItem,
            },
          ]);
        }
      }
      return res;
    };

    let redName = "æ–°ç–†";
    let planePath =
      "path://M.6,1318.313v-89.254l-319.9-221.799l0.073-208.063c0.521-84.662-26.629-121.796-63.961-121.491c-37.332-0.305-64.482,36.829-63.961,121.491l0.073,208.063l-319.9,221.799v89.254l330.343-157.288l12.238,241.308l-134.449,92.931l0.531,42.034l175.125-42.917l175.125,42.917l0.531-42.034l-134.449-92.931l12.238-241.308L1705";

    let series = [];
    [["åŒ—äº¬å¸‚", chinaDatas]].forEach(function(item, i) {
      series.push(
        {
          type: "lines",
          coordinateSystem: "GLMap",
          zlevel: 2,
          effect: {
            show: true,
            period: 4, //ç®­å¤´æŒ‡å‘é€Ÿåº¦ï¼Œå€¼è¶Šå°é€Ÿåº¦è¶Šå¿«
            trailLength: 0.1, //ç‰¹æ•ˆå°¾è¿¹é•¿åº¦[0,1]å€¼è¶Šå¤§ï¼Œå°¾è¿¹è¶Šé•¿é‡
            symbol: "circle", //ç®­å¤´å›¾æ ‡
            symbolSize: 3, //å›¾æ ‡å¤§å°
            color: "#fff",
          },
          lineStyle: {
            normal: {
              width: 0.7, //å°¾è¿¹çº¿æ¡å®½åº¦
              opacity: 0.5, //å°¾è¿¹çº¿æ¡é€æ˜åº¦
              curveness: 0.2, //å°¾è¿¹çº¿æ¡æ›²ç›´åº¦
              color: function(params) {
                return "#ffa022";
              },
            },
            color: "red",
          },
          data: convertData(item[1]),
        },
        {
          type: "effectScatter",
          coordinateSystem: "GLMap",
          zlevel: 2,
          rippleEffect: {
            //æ¶Ÿæ¼ªç‰¹æ•ˆ
            period: 4, //åŠ¨ç”»æ—¶é—´ï¼Œå€¼è¶Šå°é€Ÿåº¦è¶Šå¿«
            brushType: "fill", //æ³¢çº¹ç»˜åˆ¶æ–¹å¼ stroke, fill
            scale: 2.2, //æ³¢çº¹åœ†ç¯æœ€å¤§é™åˆ¶ï¼Œå€¼è¶Šå¤§æ³¢çº¹è¶Šå¤§
          },

          // æ‹¬ 'circle', 'rect', 'roundRect', 'triangle', 'diamond', 'pin', 'arrow', 'none'
          // symbol: 'none',
          symbol: "circle",
          symbolSize: function(val) {
            return 5; //åœ†ç¯å¤§å°
          },
          itemStyle: {
            normal: {
              show: false,
              // color: '#f00'
              color: function(params) {
                //åœ†ç¯æ˜¾ç¤ºæ–‡å­—
                // console.log('redName',redName)

                return "#ffa022";
              },
              borderWidth: 0,
              shadowColor: "#b5e8fa", //å‘å…‰ğŸ‰æ•ˆæœ
              shadowBlur: 4,
            },
          },
          tooltip: {
            //  show:false,
            trigger: "item",
            backgroundColor: "rgba(8, 18, 42, 0.85)",
            borderColor: "#040616",
            showDelay: 0,
            hideDelay: 0,
            enterable: true,
            transitionDuration: 0,
            extraCssText: "z-index:100",
            formatter: function(params, ticket, callback) {
              // æ ¹æ®ä¸šåŠ¡è‡ªå·±æ‹“å±•è¦æ˜¾ç¤ºçš„å†…å®¹
              //console.log('params--2',params)
              let res = "";
              let name = params.data.dataItem[0].name;
              let price = params.data.dataItem[0].price;
              let num = params.data.dataItem[0].num;
              res =
                "<div style='color:#fff;padding:10px;'><span>åŒ—äº¬->" +
                name +
                "</span><br/><span>å‡ä»·ï¼š" +
                price +
                "</span><br/><span>çº¿è·¯æ•°ï¼š" +
                num +
                "</span></div>";
              return res;
            },
          },
          data: item[1].map(function(dataItem) {
            // 	console.log('dataItem',dataItem[0]);
            return {
              dataItem: dataItem,
              name: dataItem[0].name,
              value: chinaGeoCoordMap[dataItem[0].name].concat([
                dataItem[0].value,
              ]),
            };
          }),
        },
        //è¢«æ”»å‡»ç‚¹
        {
          type: "scatter",
          coordinateSystem: "geo",
          zlevel: 1,
          rippleEffect: {
            period: 4,
            brushType: "stroke",
            scale: 4,
          },

          symbol: "circle",
          color: "rgba(128, 220, 251, .6)",
          symbolSize: 20,
          data: [
            {
              name: item[0],
              value: chinaGeoCoordMap[item[0]].concat([10]),
            },
          ],
        }
      );
    });

    return {
      animation: false,
      GLMap: {},
      series: series,
    };
  }
</script>
<style>
  #cesiumContainer {
    width: 100%;
    height: 100%;
    overflow: hidden;
  }
</style>
